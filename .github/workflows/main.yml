name: Build and Push

on:
  pull_request:
    branches:
    - master
  push:
    branches:
    - master
    - release/*

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Setup Node
      uses: actions/setup-node@v1
      with:
        node-version: '10.x'
    - name: Install Dependencies
      run: npm install
    - name: Build Files
      run: npm run build
    - name: put to Linode bucket
      uses: jusbrasil/github-action-s3cmd@master
      with:
        args: put --host=us-east-1.linodeobjects.com --recursive dist s3://accessu2020/${{ github.sha }}/
      env:
        ACCESS_KEY: ${{ secrets.LINODE_ACCESS_KEY }}
        SECRET_KEY: ${{ secrets.LINODE_SECRET_KEY }}
    - name: create static site
      uses: jusbrasil/github-action-s3cmd@master
      with:
        args: ws-create --host=us-east-1.linodeobjects.com --ws-index=index.html s3://accessu2020/${{ github.sha }}/
      env:
        ACCESS_KEY: ${{ secrets.LINODE_ACCESS_KEY }}
        SECRET_KEY: ${{ secrets.LINODE_SECRET_KEY }}

      
